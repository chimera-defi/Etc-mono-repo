# Fly.io Quick Start

Quick reference for deploying Cadence API to Fly.io.

## First Time Setup

```bash
# 1. Install Fly CLI (if not installed)
curl -L https://fly.io/install.sh | sh

# 2. Login to Fly.io
fly auth login

# 3. Launch app (from cadence-api directory)
fly launch --no-deploy

# 4. Set secrets
fly secrets set OPENAI_API_KEY=sk-your-actual-api-key
fly secrets set GITHUB_CLIENT_ID=your-github-client-id
fly secrets set GITHUB_CLIENT_SECRET=your-github-client-secret
fly secrets set JWT_SECRET=your-long-random-secret-key

# Optional VPS configuration
fly secrets set VPS_ENDPOINT=https://your-vps-endpoint.com
fly secrets set VPS_API_KEY=your-vps-api-key

# 5. Deploy
fly deploy
```

## Common Commands

```bash
# Deploy changes
fly deploy

# View status
fly status

# View logs (real-time)
fly logs

# SSH into machine
fly ssh console

# Open app in browser
fly open

# Check app dashboard
fly dashboard

# Scale machine
fly scale vm shared-cpu-2x
fly scale memory 1024

# Suspend/resume app
fly apps suspend cadence-api
fly apps resume cadence-api
```

## Environment Variables

**Public** (set in fly.toml):
- NODE_ENV=production
- PORT=3001
- HOST=0.0.0.0
- LOG_LEVEL=info

**Secrets** (set via CLI):
- OPENAI_API_KEY (required)
- GITHUB_CLIENT_ID (required for auth)
- GITHUB_CLIENT_SECRET (required for auth)
- JWT_SECRET (required for auth)
- VPS_ENDPOINT (optional)
- VPS_API_KEY (optional)

## Health Check

Test: `curl https://cadence-api.fly.dev/api/health`

Expected response: `{"status":"ok","timestamp":"..."}`

## Troubleshooting

**Build fails:**
```bash
# Test build locally
docker build -t cadence-api-test .
```

**Health check fails:**
```bash
# Check logs
fly logs --filter health

# SSH and check manually
fly ssh console
curl http://localhost:3001/api/health
```

**Out of memory:**
```bash
fly scale memory 1024
```

## Cost Optimization

Current config: ~$3-5/month with auto-stop
- Shared CPU: $0.0000002/s when running
- 512MB RAM: Included
- Auto-stop: Stops when idle (saves money)
- Min 1 machine: Ensures availability

## Full Documentation

See `DEPLOYMENT.md` for complete deployment guide.
