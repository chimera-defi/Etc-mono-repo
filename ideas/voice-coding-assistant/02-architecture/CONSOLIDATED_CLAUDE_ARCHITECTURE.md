# Consolidated Architecture: Cursor Features â†’ Claude Agent SDK

> Mapping reverse-engineered Cursor capabilities to Claude Agent SDK implementation

---

## Executive Summary

This document maps every Cursor Agents feature (from PR #35 analysis) to its Claude Agent SDK implementation, showing exactly how we build feature parity while adding voice/mobile advantages.

**Key Insight:** Claude Agent SDK provides ~80% of Cursor's agent capabilities out-of-the-box. The remaining 20% requires custom infrastructure (execution environment, orchestration, codebase analysis).

---

## 1. Feature Mapping Matrix

### Core Agent Features

| Cursor Feature | Claude Agent SDK Equivalent | Implementation | Status |
|----------------|----------------------------|----------------|--------|
| **Create agent from prompt** | `query({ prompt })` | Direct SDK call | âœ… Native |
| **Execute on repository** | `query({ cwd })` | Point to cloned repo | âœ… Native |
| **File read/write** | Built-in Read/Edit/Write tools | Automatic | âœ… Native |
| **Run bash commands** | Built-in Bash tool | Automatic | âœ… Native |
| **Search codebase** | Built-in Glob/Grep tools | Automatic | âœ… Native |
| **Create git commits** | Bash tool + git commands | Automatic | âœ… Native |
| **Create branches** | Bash tool + git commands | Automatic | âœ… Native |
| **Streaming responses** | AsyncGenerator return | Stream events | âœ… Native |

### Agent Control Features

| Cursor Feature | Implementation Approach | Complexity |
|----------------|------------------------|------------|
| **Pause agent** | Cancel SDK query + checkpoint state | MEDIUM |
| **Resume agent** | Restore checkpoint + new query | MEDIUM |
| **Stop/Cancel agent** | Cancel SDK query + cleanup | LOW |
| **Real-time status** | PostToolUse hooks + WebSocket | LOW |
| **Progress tracking** | PostToolUse hooks count operations | LOW |
| **Agent logs** | PostToolUse hooks log all actions | LOW |

### Context & Input Features

| Cursor Feature | Implementation Approach | Complexity |
|----------------|------------------------|------------|
| **Codebase context** | Custom CodebaseAnalyzer + prompt injection | HIGH |
| **@Files references** | Parse command â†’ fetch file â†’ inject in prompt | MEDIUM |
| **@Web search** | Parse command â†’ web search API â†’ inject results | MEDIUM |
| **Image context** | Claude Vision API for screenshots | LOW |
| **Multi-file editing** | SDK naturally handles via Edit tool | âœ… Native |
| **Follow-up instructions** | Append to conversation, continue query | LOW |

### Our Advantages (Not in Cursor)

| Feature | Implementation | Complexity |
|---------|----------------|------------|
| **Voice input** | Whisper API â†’ Command Parser â†’ Agent | MEDIUM |
| **Voice output** | expo-speech for status updates | LOW |
| **Mobile app** | React Native + Expo | MEDIUM |
| **Push notifications** | expo-notifications on completion | LOW |
| **Offline viewing** | AsyncStorage cache | LOW |

---

## 2. System Architecture (Complete View)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MOBILE APPLICATION                                  â”‚
â”‚                         (React Native + Expo)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Voice Input  â”‚   â”‚ Agent List   â”‚   â”‚ Agent Detail â”‚   â”‚  Settings    â”‚ â”‚
â”‚  â”‚              â”‚   â”‚              â”‚   â”‚              â”‚   â”‚              â”‚ â”‚
â”‚  â”‚ [ğŸ¤ Record]  â”‚   â”‚ [Agent 1]    â”‚   â”‚ Status: âœ…    â”‚   â”‚ Voice: On    â”‚ â”‚
â”‚  â”‚              â”‚   â”‚ [Agent 2]    â”‚   â”‚ PR: #245     â”‚   â”‚ Model: Sonnetâ”‚ â”‚
â”‚  â”‚ Transcript:  â”‚   â”‚ [Agent 3]    â”‚   â”‚ Files: 12    â”‚   â”‚ Notificationsâ”‚ â”‚
â”‚  â”‚ "Add dark..."â”‚   â”‚              â”‚   â”‚              â”‚   â”‚              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ Voice Command                                                      â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Voice Processing Layer                         â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ expo-av     â”‚â”€â”€â”€>â”‚ Whisper API â”‚â”€â”€â”€>â”‚ Command Parser          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Recording   â”‚    â”‚ (STT)       â”‚    â”‚ (Claude Haiku)          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚             â”‚    â”‚             â”‚    â”‚                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Audio: M4A  â”‚    â”‚ Transcript  â”‚    â”‚ Intent: CREATE_AGENT    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚             â”‚    â”‚ "Add dark   â”‚    â”‚ Repo: wallet-frontend   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚             â”‚    â”‚  mode to    â”‚    â”‚ Task: Add dark mode     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚             â”‚    â”‚  navigation"â”‚    â”‚ Branch: feature/dark    â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                       â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â”‚ HTTPS POST /api/agents
                                                        â”‚ Authorization: Bearer JWT
                                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              BACKEND API                                      â”‚
â”‚                            (Fastify + Node.js)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          API Routes                                   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  POST /api/agents          â†’ Create agent                            â”‚   â”‚
â”‚  â”‚  GET  /api/agents          â†’ List agents                             â”‚   â”‚
â”‚  â”‚  GET  /api/agents/:id      â†’ Agent detail                            â”‚   â”‚
â”‚  â”‚  POST /api/agents/:id/pause â†’ Pause agent                            â”‚   â”‚
â”‚  â”‚  POST /api/agents/:id/resume â†’ Resume agent                          â”‚   â”‚
â”‚  â”‚  DELETE /api/agents/:id    â†’ Cancel agent                            â”‚   â”‚
â”‚  â”‚  GET  /api/agents/:id/logs â†’ Agent logs                              â”‚   â”‚
â”‚  â”‚  WS   /ws/agents/:id       â†’ Real-time updates                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       Agent Orchestrator                              â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Job Queue   â”‚    â”‚ State Mgr   â”‚    â”‚ Health Monitor          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ (BullMQ)    â”‚    â”‚ (Redis)     â”‚    â”‚                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚             â”‚    â”‚             â”‚    â”‚ - Heartbeat check       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ - Enqueue   â”‚    â”‚ - Checkpts  â”‚    â”‚ - Timeout detection     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ - Priority  â”‚    â”‚ - Recovery  â”‚    â”‚ - Stalled job recovery  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ - Retry     â”‚    â”‚ - Locks     â”‚    â”‚                         â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                                                                 â”‚
â”‚            â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Codebase Analyzer                                â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  Input: Repository URL + Task Description                             â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ 1. Fetch repo tree (GitHub API)                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 2. Detect framework (Next.js, React, Express, etc.)             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 3. Analyze dependencies (package.json, requirements.txt)        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 4. Select relevant files (Claude Haiku analysis)                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 5. Cache result (24h TTL)                                       â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  Output: CodebaseContext { framework, relevantFiles, structure }     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       Execution Service                               â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  Provisions isolated containers for agent execution                   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Container Platforms (Choose One):                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Option A: Modal.com        Option B: Fly.io Machines           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Python/Node runtime      - Docker containers                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Pay per second           - Pay per second                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Auto-scaling             - Global edge                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - GPU support              - Persistent volumes                â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  Container Setup:                                                     â”‚   â”‚
â”‚  â”‚  1. Clone repository                                                  â”‚   â”‚
â”‚  â”‚  2. Install dependencies (npm install / pip install)                  â”‚   â”‚
â”‚  â”‚  3. Inject Claude Agent SDK                                           â”‚   â”‚
â”‚  â”‚  4. Execute agent task                                                â”‚   â”‚
â”‚  â”‚  5. Stream logs back                                                  â”‚   â”‚
â”‚  â”‚  6. Cleanup on completion                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXECUTION CONTAINER (Isolated)                          â”‚
â”‚                         (Modal / Fly.io / Docker)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Claude Agent SDK                              â”‚   â”‚
â”‚  â”‚                    (@anthropic-ai/claude-agent-sdk)                   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  const response = await query({                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    prompt: `                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Task: ${task.description}                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Repository: ${task.repoUrl}                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Framework: ${context.framework}                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Relevant files: ${context.relevantFiles.join(', ')}        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Complete this task autonomously. Create a PR when done.    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    `,                                                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    cwd: '/workspace/repo',                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    model: 'claude-sonnet-4-20250514',                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    apiKey: process.env.ANTHROPIC_API_KEY,                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    // HOOKS: Real-time monitoring & control                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    hooks: {                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      PreToolUse: [{                                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        matcher: 'Edit|Write|Bash',                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        callback: async (input) => {                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          // Security validation                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          if (isDangerous(input)) {                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            return { decision: 'block' };                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          }                                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          // Log for real-time updates                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          await streamToBackend({                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            type: 'tool_start',                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            tool: input.tool_name,                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            file: input.tool_input.file_path                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          });                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          return {};                                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        }                                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      }],                                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      PostToolUse: [{                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        matcher: '*',                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        callback: async (input) => {                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          // Update progress                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          toolCount++;                                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          await streamToBackend({                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            type: 'progress',                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            toolCount,                                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            lastTool: input.tool_name,                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            result: input.tool_result                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          });                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          return {};                                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        }                                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      }],                                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      Stop: [{                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        matcher: '',                                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        callback: async (input) => {                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          // Agent completed                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          await streamToBackend({                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            type: 'completed',                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚            result: input.stop_reason                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          });                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚          return {};                                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        }                                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      }]                                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    }                                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  });                                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  Built-in Tools (automatic):                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚   Read    â”‚ â”‚   Edit    â”‚ â”‚   Write   â”‚ â”‚   Bash    â”‚            â”‚   â”‚
â”‚  â”‚  â”‚           â”‚ â”‚           â”‚ â”‚           â”‚ â”‚           â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ Read any  â”‚ â”‚ Edit file â”‚ â”‚ Create    â”‚ â”‚ Run shell â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ file      â”‚ â”‚ sections  â”‚ â”‚ new files â”‚ â”‚ commands  â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚   Glob    â”‚ â”‚   Grep    â”‚ â”‚WebSearch  â”‚ â”‚  WebFetch â”‚            â”‚   â”‚
â”‚  â”‚  â”‚           â”‚ â”‚           â”‚ â”‚           â”‚ â”‚           â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ Find filesâ”‚ â”‚ Search    â”‚ â”‚ Search    â”‚ â”‚ Fetch     â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ by patternâ”‚ â”‚ content   â”‚ â”‚ the web   â”‚ â”‚ web pages â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Security Sandbox:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Network: Egress only to GitHub, npm, PyPI, APIs                    â”‚   â”‚
â”‚  â”‚ â€¢ Resources: 2 CPU, 4GB RAM, 10GB disk, 60 min timeout               â”‚   â”‚
â”‚  â”‚ â€¢ Filesystem: /workspace only, no host access                        â”‚   â”‚
â”‚  â”‚ â€¢ Privileges: No root, no docker, no network admin                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Streams events via WebSocket/HTTP
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           EXTERNAL SERVICES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Anthropic  â”‚  â”‚   GitHub    â”‚  â”‚   OpenAI    â”‚  â”‚   Neon      â”‚        â”‚
â”‚  â”‚  Claude API â”‚  â”‚   API       â”‚  â”‚  Whisper    â”‚  â”‚  Postgres   â”‚        â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚        â”‚
â”‚  â”‚ - Agent SDK â”‚  â”‚ - OAuth     â”‚  â”‚ - STT       â”‚  â”‚ - Users     â”‚        â”‚
â”‚  â”‚ - Haiku     â”‚  â”‚ - Repos     â”‚  â”‚ - Voice     â”‚  â”‚ - Agents    â”‚        â”‚
â”‚  â”‚ - Vision    â”‚  â”‚ - PRs       â”‚  â”‚   input     â”‚  â”‚ - Logs      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Redis     â”‚  â”‚   Pusher    â”‚  â”‚   Sentry    â”‚  â”‚   PostHog   â”‚        â”‚
â”‚  â”‚  (Upstash)  â”‚  â”‚  Real-time  â”‚  â”‚   Errors    â”‚  â”‚  Analytics  â”‚        â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚        â”‚
â”‚  â”‚ - Sessions  â”‚  â”‚ - WebSocket â”‚  â”‚ - Tracking  â”‚  â”‚ - Events    â”‚        â”‚
â”‚  â”‚ - Cache     â”‚  â”‚ - Push      â”‚  â”‚ - Alerts    â”‚  â”‚ - Funnels   â”‚        â”‚
â”‚  â”‚ - Queues    â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Data Flow: Voice Command to PR Creation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Voice Input                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  User speaks: "Add dark mode toggle to the navigation bar in wallet-frontend"â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ expo-av     â”‚â”€â”€â”€â”€>â”‚ M4A Audio   â”‚â”€â”€â”€â”€>â”‚ POST api.openai.com/v1/audio    â”‚â”‚
â”‚  â”‚ Recording   â”‚     â”‚ ~50KB       â”‚     â”‚                                 â”‚â”‚
â”‚  â”‚             â”‚     â”‚             â”‚     â”‚ Response: { text: "Add dark..." }â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Command Parsing (Claude Haiku)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  Prompt to Claude Haiku:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Parse this voice command into structured data:                           â”‚â”‚
â”‚  â”‚ Input: "Add dark mode toggle to the navigation bar in wallet-frontend"   â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚ Extract:                                                                 â”‚â”‚
â”‚  â”‚ - intent: CREATE_AGENT | STATUS_CHECK | PAUSE | RESUME | STOP           â”‚â”‚
â”‚  â”‚ - repository: repository name or URL                                     â”‚â”‚
â”‚  â”‚ - task: the coding task description                                      â”‚â”‚
â”‚  â”‚ - branch: target branch (optional)                                       â”‚â”‚
â”‚  â”‚ - file_references: any @file mentions                                    â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚ Return JSON only.                                                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  Response:                                                                    â”‚
â”‚  {                                                                            â”‚
â”‚    "intent": "CREATE_AGENT",                                                  â”‚
â”‚    "repository": "wallet-frontend",                                           â”‚
â”‚    "task": "Add dark mode toggle to the navigation bar",                      â”‚
â”‚    "branch": null,                                                            â”‚
â”‚    "file_references": []                                                      â”‚
â”‚  }                                                                            â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Repository Lookup & Context Building                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  3a. Resolve repository:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ SELECT * FROM user_repos WHERE user_id = ? AND name ILIKE 'wallet%'      â”‚â”‚
â”‚  â”‚ Result: { url: 'github.com/user/wallet-frontend', default_branch: 'main' }â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  3b. Build codebase context (CodebaseAnalyzer):                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 1. Fetch repo tree via GitHub API                                        â”‚â”‚
â”‚  â”‚ 2. Detect framework: Next.js (next.config.js found)                       â”‚â”‚
â”‚  â”‚ 3. Analyze package.json: { tailwindcss, react, next }                     â”‚â”‚
â”‚  â”‚ 4. Select relevant files via Claude:                                      â”‚â”‚
â”‚  â”‚    - src/components/Navigation.tsx                                        â”‚â”‚
â”‚  â”‚    - src/contexts/ThemeContext.tsx                                        â”‚â”‚
â”‚  â”‚    - tailwind.config.js                                                   â”‚â”‚
â”‚  â”‚    - src/styles/globals.css                                               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  Context Result:                                                              â”‚
â”‚  {                                                                            â”‚
â”‚    "framework": "nextjs",                                                     â”‚
â”‚    "language": "typescript",                                                  â”‚
â”‚    "relevantFiles": ["src/components/Navigation.tsx", ...],                   â”‚
â”‚    "dependencies": ["tailwindcss", "react", "next"],                          â”‚
â”‚    "hasExistingTheme": true                                                   â”‚
â”‚  }                                                                            â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Agent Creation & Execution                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  4a. Create agent record:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ INSERT INTO agents (user_id, repo_url, task, status, branch) VALUES (    â”‚â”‚
â”‚  â”‚   'user-123',                                                            â”‚â”‚
â”‚  â”‚   'github.com/user/wallet-frontend',                                     â”‚â”‚
â”‚  â”‚   'Add dark mode toggle to the navigation bar',                          â”‚â”‚
â”‚  â”‚   'CREATING',                                                            â”‚â”‚
â”‚  â”‚   'feature/dark-mode-toggle'                                             â”‚â”‚
â”‚  â”‚ ) RETURNING id;                                                          â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚ Result: { id: 'agent-456' }                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  4b. Provision execution container:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ // Modal.com example                                                     â”‚â”‚
â”‚  â”‚ const container = await modal.spawn({                                    â”‚â”‚
â”‚  â”‚   image: 'node:20-slim',                                                 â”‚â”‚
â”‚  â”‚   cpu: 2,                                                                â”‚â”‚
â”‚  â”‚   memory: 4096,                                                          â”‚â”‚
â”‚  â”‚   timeout: 3600,                                                         â”‚â”‚
â”‚  â”‚   env: {                                                                 â”‚â”‚
â”‚  â”‚     ANTHROPIC_API_KEY: secrets.ANTHROPIC_API_KEY,                        â”‚â”‚
â”‚  â”‚     GITHUB_TOKEN: user.githubToken                                       â”‚â”‚
â”‚  â”‚   }                                                                      â”‚â”‚
â”‚  â”‚ });                                                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  4c. Clone repository in container:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ git clone --depth 1 https://token@github.com/user/wallet-frontend.git   â”‚â”‚
â”‚  â”‚ cd wallet-frontend                                                       â”‚â”‚
â”‚  â”‚ git checkout -b feature/dark-mode-toggle                                 â”‚â”‚
â”‚  â”‚ npm install                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  4d. Execute Claude Agent SDK:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ const response = await query({                                           â”‚â”‚
â”‚  â”‚   prompt: `                                                              â”‚â”‚
â”‚  â”‚     You are working on a Next.js TypeScript project.                     â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚     Task: Add dark mode toggle to the navigation bar                     â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚     Relevant files to examine:                                           â”‚â”‚
â”‚  â”‚     - src/components/Navigation.tsx                                      â”‚â”‚
â”‚  â”‚     - src/contexts/ThemeContext.tsx                                      â”‚â”‚
â”‚  â”‚     - tailwind.config.js                                                 â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚     Requirements:                                                        â”‚â”‚
â”‚  â”‚     1. Add a toggle button in the navigation bar                         â”‚â”‚
â”‚  â”‚     2. Use existing theme context if available                           â”‚â”‚
â”‚  â”‚     3. Persist preference to localStorage                                â”‚â”‚
â”‚  â”‚     4. Use Tailwind dark: classes                                        â”‚â”‚
â”‚  â”‚     5. Run tests if they exist                                           â”‚â”‚
â”‚  â”‚     6. Commit changes with descriptive message                           â”‚â”‚
â”‚  â”‚     7. Push to feature/dark-mode-toggle branch                           â”‚â”‚
â”‚  â”‚   `,                                                                     â”‚â”‚
â”‚  â”‚   cwd: '/workspace/wallet-frontend',                                     â”‚â”‚
â”‚  â”‚   model: 'claude-sonnet-4-20250514',                                    â”‚â”‚
â”‚  â”‚   hooks: { PreToolUse: [...], PostToolUse: [...] }                       â”‚â”‚
â”‚  â”‚ });                                                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ Streaming events via hooks
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Real-time Progress Updates                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  PostToolUse Hook Events (streamed to mobile):                                â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Event 1    â”‚ { type: 'tool', tool: 'Read', file: 'Navigation.tsx' }      â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Event 2    â”‚ { type: 'tool', tool: 'Read', file: 'ThemeContext.tsx' }    â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Event 3    â”‚ { type: 'tool', tool: 'Edit', file: 'Navigation.tsx' }      â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Event 4    â”‚ { type: 'tool', tool: 'Write', file: 'DarkModeToggle.tsx' } â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Event 5    â”‚ { type: 'tool', tool: 'Bash', cmd: 'npm run test' }         â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Event 6    â”‚ { type: 'tool', tool: 'Bash', cmd: 'git commit -m ...' }    â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Event 7    â”‚ { type: 'tool', tool: 'Bash', cmd: 'git push origin ...' }  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  Mobile app receives via WebSocket, updates UI:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Agent: Dark Mode Toggle                                                 â”‚â”‚
â”‚  â”‚  Status: Running                                                         â”‚â”‚
â”‚  â”‚  Progress: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%                                                â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚  Recent activity:                                                        â”‚â”‚
â”‚  â”‚  âœ“ Read Navigation.tsx                                                   â”‚â”‚
â”‚  â”‚  âœ“ Modified Navigation.tsx                                               â”‚â”‚
â”‚  â”‚  âœ“ Created DarkModeToggle.tsx                                            â”‚â”‚
â”‚  â”‚  âŸ³ Running tests...                                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: PR Creation & Completion                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  6a. Agent creates PR via GitHub API (or `gh` CLI):                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ gh pr create \                                                           â”‚â”‚
â”‚  â”‚   --title "Add dark mode toggle to navigation bar" \                     â”‚â”‚
â”‚  â”‚   --body "## Summary\n- Added DarkModeToggle component\n..." \           â”‚â”‚
â”‚  â”‚   --base main \                                                          â”‚â”‚
â”‚  â”‚   --head feature/dark-mode-toggle                                        â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚ Result: https://github.com/user/wallet-frontend/pull/42                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  6b. Update database:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ UPDATE agents SET                                                        â”‚â”‚
â”‚  â”‚   status = 'COMPLETED',                                                  â”‚â”‚
â”‚  â”‚   pr_number = 42,                                                        â”‚â”‚
â”‚  â”‚   pr_url = 'https://github.com/user/wallet-frontend/pull/42',            â”‚â”‚
â”‚  â”‚   files_changed = 3,                                                     â”‚â”‚
â”‚  â”‚   commits_count = 1,                                                     â”‚â”‚
â”‚  â”‚   finished_at = NOW()                                                    â”‚â”‚
â”‚  â”‚ WHERE id = 'agent-456';                                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  6c. Send push notification to mobile:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ {                                                                        â”‚â”‚
â”‚  â”‚   title: "Agent Completed! ğŸ‰",                                          â”‚â”‚
â”‚  â”‚   body: "Dark mode toggle added. PR #42 ready for review.",              â”‚â”‚
â”‚  â”‚   data: {                                                                â”‚â”‚
â”‚  â”‚     agentId: "agent-456",                                                â”‚â”‚
â”‚  â”‚     prUrl: "https://github.com/user/wallet-frontend/pull/42"             â”‚â”‚
â”‚  â”‚   }                                                                      â”‚â”‚
â”‚  â”‚ }                                                                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â”‚  6d. Speak confirmation (if voice output enabled):                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ expo-speech: "Your agent has completed. Pull request 42 is ready         â”‚â”‚
â”‚  â”‚              for review on wallet-frontend."                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. MCP Integration Points

### Custom MCP Servers for Claudia

```typescript
// mcp-servers/claudia-dev.ts
// MCP server that exposes Claudia-specific tools to Claude Code

import { Server } from '@modelcontextprotocol/sdk/server/index.js';

const server = new Server({
  name: 'claudia-dev',
  version: '1.0.0'
});

// Tool: Get agent status
server.setRequestHandler('tools/list', async () => ({
  tools: [
    {
      name: 'get_agent_status',
      description: 'Get status of a Claudia agent by ID',
      inputSchema: {
        type: 'object',
        properties: {
          agentId: { type: 'string' }
        },
        required: ['agentId']
      }
    },
    {
      name: 'list_user_agents',
      description: 'List all agents for the current user',
      inputSchema: {
        type: 'object',
        properties: {
          status: { type: 'string', enum: ['all', 'running', 'completed', 'failed'] }
        }
      }
    },
    {
      name: 'get_voice_metrics',
      description: 'Get voice recognition accuracy metrics',
      inputSchema: {
        type: 'object',
        properties: {
          timeRange: { type: 'string', enum: ['day', 'week', 'month'] }
        }
      }
    }
  ]
}));

// Implement tool execution
server.setRequestHandler('tools/call', async (request) => {
  switch (request.params.name) {
    case 'get_agent_status':
      const agent = await fetchAgentFromAPI(request.params.arguments.agentId);
      return { content: [{ type: 'text', text: JSON.stringify(agent) }] };

    case 'list_user_agents':
      const agents = await fetchUserAgents(request.params.arguments.status);
      return { content: [{ type: 'text', text: JSON.stringify(agents) }] };

    case 'get_voice_metrics':
      const metrics = await fetchVoiceMetrics(request.params.arguments.timeRange);
      return { content: [{ type: 'text', text: JSON.stringify(metrics) }] };
  }
});
```

**Install in Claude Code:**
```bash
claude mcp add claudia-dev --transport stdio -- node ./mcp-servers/claudia-dev.js
```

---

## 5. Claude Code Hooks for Development

### Development Hooks Configuration

```json
// .claude/settings.json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [{
          "type": "command",
          "command": ".claude/hooks/validate-bash.sh",
          "timeout": 30
        }]
      },
      {
        "matcher": "Edit|Write",
        "hooks": [{
          "type": "command",
          "command": ".claude/hooks/check-file-size.sh",
          "timeout": 10
        }]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [{
          "type": "command",
          "command": ".claude/hooks/lint-file.sh",
          "timeout": 60
        }]
      }
    ],
    "Stop": [
      {
        "matcher": "",
        "hooks": [{
          "type": "command",
          "command": ".claude/hooks/final-validation.sh",
          "timeout": 120
        }]
      }
    ]
  }
}
```

### Slash Commands for Development

```markdown
<!-- .claude/commands/claudia-component.md -->
---
description: "Create a new Claudia React Native component"
allowed-tools: ["Read", "Write", "Edit", "Glob"]
---

Create a new React Native component for Claudia at: $ARGUMENTS

Follow these patterns:
1. Use TypeScript with strict types
2. Use Zustand for state if needed
3. Include accessibility props for voice users
4. Add proper error boundaries
5. Export from components/index.ts

Check existing components in src/components/ for style reference.
```

```markdown
<!-- .claude/commands/claudia-test.md -->
---
description: "Run Claudia test suite with coverage"
allowed-tools: ["Bash", "Read"]
---

Run the Claudia test suite:

1. Run unit tests: `npm run test`
2. Run integration tests: `npm run test:integration`
3. Generate coverage report
4. Report any failures with file:line references
```

---

## 6. Implementation Checklist

### Backend Components

| Component | Maps to Cursor Feature | Claude SDK Usage | Priority | Effort |
|-----------|----------------------|------------------|----------|--------|
| AgentOrchestrator | Agent lifecycle | Job queue + SDK | P0 | 2 weeks |
| ExecutionService | Code execution | Container + SDK | P0 | 2 weeks |
| CodebaseAnalyzer | @Codebase context | Claude Haiku | P0 | 1 week |
| WebhookReceiver | PR updates | GitHub webhooks | P1 | 3 days |
| CostTracker | Usage limits | DB + events | P1 | 1 week |

### Mobile Components

| Component | Maps to Cursor Feature | Implementation | Priority | Effort |
|-----------|----------------------|----------------|----------|--------|
| VoiceInput | N/A (advantage) | Whisper + expo-av | P0 | 1 week |
| CommandParser | Chat input | Claude Haiku | P0 | 3 days |
| AgentListScreen | Agent dashboard | TanStack Query | P0 | 3 days |
| AgentDetailScreen | Agent detail | WebSocket updates | P0 | 3 days |
| CreateAgentFlow | Agent creation | 3-step wizard | P0 | 1 week |
| PushNotifications | N/A (advantage) | expo-notifications | P0 | 2 days |

### Integration Points

| Integration | Purpose | API/SDK Used | Priority |
|-------------|---------|--------------|----------|
| Claude Agent SDK | Agent execution | @anthropic-ai/claude-agent-sdk | P0 |
| Claude Haiku | Command parsing | Anthropic API | P0 |
| Claude Vision | Image context | Anthropic API | P1 |
| GitHub OAuth | Authentication | expo-auth-session | P0 |
| GitHub API | Repo operations | REST API | P0 |
| Whisper API | Voice transcription | OpenAI API | P0 |
| expo-speech | Voice output | Built-in | P0 |

---

## 7. Summary

### What We Get from Claude Agent SDK

- **Free:** File read/write, code search, bash execution, git operations
- **Free:** Multi-file editing (via Edit/Write tools)
- **Free:** Web search integration (WebSearch tool)
- **Free:** Streaming responses
- **Free:** Tool use hooks for monitoring

### What We Must Build

- **ExecutionService:** Container provisioning and lifecycle
- **AgentOrchestrator:** Job queue, state management, recovery
- **CodebaseAnalyzer:** Repository context for agents
- **VoiceProcessing:** STT/TTS integration
- **Mobile App:** React Native + Expo shell

### Competitive Position

| Feature | Cursor | Claudia | Winner |
|---------|--------|---------|--------|
| Agent execution | âœ… | âœ… (via SDK) | Tie |
| Multi-file editing | âœ… | âœ… (via SDK) | Tie |
| Codebase context | âœ… | âš ï¸ (must build) | Cursor |
| Voice input | âŒ | âœ… | **Claudia** |
| Mobile app | âŒ | âœ… | **Claudia** |
| Offline viewing | âŒ | âœ… | **Claudia** |
| Push notifications | âŒ | âœ… | **Claudia** |
| Price | $20/mo | $10/mo | **Claudia** |

---

**Document Version:** 1.0
**Created:** December 25, 2024
**Status:** Architecture Mapping Complete
