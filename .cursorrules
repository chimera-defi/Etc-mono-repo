# =============================================================================
# AI ASSISTANT RULES — TOKEN-EFFICIENT, QUALITY-PRESERVING, MCP-FIRST
# Applies to Cursor, Claude, Gemini, ChatGPT
# =============================================================================

## CORE DIRECTIVE
Optimize for correctness, verification, insight quality, and token efficiency.
Reduce tokens via scope control and reuse, not by removing reasoning.

Mantra: Minimal input. Controlled output. Expand on demand.

---

## TOOLING & ENVIRONMENT (PRECONDITION)
- Required tools MUST be installed and verified before use:
  - MCP CLI
  - Required language/toolchain binaries
- Do NOT assume tooling availability.
- Verify installation before issuing commands or relying on outputs.
- Use **bun** instead of npm unless explicitly instructed otherwise.

No tool usage before verification.

---

## CONTEXT & SCOPE
- Never process full repositories unless explicitly required.
- Operate only on: named files, ranges, symbols, diffs, MCP refs.
- Prefer summaries over raw content.
- Ask at most one clarifying question.
- Expand scope only for correctness, safety, or explicit request.

---

## MCP-FIRST DOCTRINE
Execution order (mandatory):

1. Verify MCP CLI is installed and configured
2. Query MCP memory
3. Use MCP filesystem/search tools
4. Batch related operations
5. Fallback only if MCP fails

Raw file dumps are last resort.

---

## MULTI-PASS REVIEW (NON-NEGOTIABLE)
For non-trivial work, apply **at least two passes**:

1. **Pass 1 — Construction**
   - Implement solution
   - Make assumptions explicit
2. **Pass 2 — Review**
   - Re-check logic, edge cases, and constraints
   - Verify against repo structure and rules

For high-risk changes (infra, finance, security):
- Add a **Pass 3 — Validation** (re-verify with fresh perspective)

Do not merge construction and review into one pass.

---

## SUMMARY CACHE PROTOCOL
After non-trivial work, produce a summary with:
- Cache key
- One-line intent
- Key decisions
- Outputs

On follow-ups:
- Use summary as authoritative
- Re-read raw content only if assumptions change

---

## TOKEN-SAFE WORKFLOW (DEFAULT)
- Core answer ≤5 bullets
- Suggestions allowed (≤3)
- Code: diff-only or minimal snippets
- Full files only on request
- Reasoning internal; explanations summarized

---

## RESPONSE FORMAT
- Direct answer first
- Optional “Suggestions / Follow-ups”
- No prompt restatement
- No verbose narration

---

## RE-ANALYSIS CONTROL
- Do not re-analyze identical context.
- If already analyzed: “Using prior summary.”
- Re-analysis allowed only if inputs change or user requests it.

---

## VERIFICATION DOCTRINE
Verify:
- Project structure
- Import paths
- Numbers and calculations
- Framework behavior

Prefer docs, CLI output, repo inspection, MCP memory.
Mark uncertainty explicitly.

---

## ANTI-HALLUCINATION
Do not invent numbers, certifications, feature support, or completion claims.
Label: Verified / Approximate / Unknown.

---

## PROJECT HYGIENE
- AI artifacts → `.cursor/artifacts/`
- Do not clutter repo root
- READMEs must reflect actual runnable state

---

## PR & COMMIT ATTRIBUTION
- Attribute **model name**, not platform
- PRs include: Agent, prompt, summary
- Commits include: `[Agent: Model]` + human co-author

---

## DOMAIN AUTHORITY
Framework, finance, SEO, wallet, scraping, and smart-contract rules defined elsewhere remain authoritative.

When unsure: verify structure, math, and runability.

---

## TOKEN BUDGET (GUIDELINES)
- Simple answer: ~100 tokens
- Code diff: ~200
- Summary: ~300
- Large tasks require summaries; avoid raw context reuse

---

## MODEL-SPECIFIC NOTES
**Claude:** compress output; bullets over prose; surface conclusions only.  
**Cursor:** repo rules override; summaries authoritative.  
**Gemini / ChatGPT:** same scope, verification, and escalation rules.

---

## UNIVERSAL PROMPT PATTERN (CHEAP → DEEP)
Default: concise answer + cheap suggestions.
Expand only on explicit signals:
- “go deeper”
- “expand suggestion #X”
- “show reasoning”
- “explore tradeoffs”
- “re-validate assumptions”

---

## FOLLOW-UPS
Follow-ups and suggestions are encouraged.
Keep them labeled, short, and optional unless expanded.

---

## TERMINATION
End naturally. Allow iterative refinement when useful.