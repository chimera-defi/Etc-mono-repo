# Wallet Radar Malware Alert — Diagnosis & Fix Handoff

> **Ref:** Porkbun Abuse Report | CleanDNS Case #69904e06986d58184c5465b6  
> **Domain:** walletradar.org, www.walletradar.org  
> **Reported:** Domain hosting malware (SHA-256: `ab5ce83454ba10b7af7287a0556a7feef2fb4a9a9e5d05f5599a377528ea888d`)

---

## 1. Report Summary

- **Offending domains:** walletradar.org, www.walletradar.org
- **Reported URLs:** `https://walletradar.org/`, `https://www.walletradar.org/`
- **Claim:** Domain hosting malware; screenshot evidence
- **VirusTotal URL:** `https://www.virustotal.com/gui/url/4da0b16abc7447d1f4a54a9c2c2d2cc2ae8db5c393ce3f2ca6ca7240bdc62cd5`
- **CleanDNS case:** http://url718.reports.cleandns.space/ls/click?upn=... (see original email)

---

## 2. Investigation Vectors (wallets/frontend)

### 2.1 Third-party scripts (high priority)

| Location | Script | Risk |
|----------|--------|------|
| `wallets/frontend/src/app/layout.tsx` L147–195 | Google Analytics (gtag) from `googletagmanager.com` | GA can load third-party scripts; if GA or its CDN is compromised, it could serve malicious content |
| `next.config.js` L41 | CSP allows `script-src ... https://www.googletagmanager.com https://www.google-analytics.com` | Confirms GA is whitelisted |

**Action:** Check VirusTotal for `googletagmanager.com` and `google-analytics.com`. If the flagged hash matches a GA script, consider temporarily disabling GA or switching to a self-hosted analytics solution.

### 2.2 rehype-raw (medium priority)

| Location | Behavior |
|----------|----------|
| `wallets/frontend/src/components/EnhancedMarkdownRenderer.tsx` L7, L677 | `rehype-raw` allows raw HTML in markdown |

**Risk:** Markdown content can include `<script>`, `<iframe>`, or `<img src="...">` that loads external resources. Content is from repo markdown, not user input, but any malicious HTML in markdown would be rendered.

**Action:** Audit all markdown under `wallets/` for raw HTML (especially `<script>`, `<iframe>`, `<object>`, `javascript:`):

```bash
rg -g "*.md" "<script|<iframe|<object|javascript:" wallets/
```

If none found, consider removing `rehype-raw` if raw HTML is not required.

### 2.3 Image sources (medium priority)

| Location | Behavior |
|----------|----------|
| `EnhancedMarkdownRenderer.tsx` L689–698 | `img` component uses `src` directly with no validation |

**Risk:** Markdown images can point to arbitrary URLs. If markdown contains `<img src="https://malicious.com/...">`, it would load.

**Action:** Same markdown audit as above. Optionally restrict `img` `src` to same-origin or an allowlist.

### 2.4 Manifest / PWA icons (low priority)

| Location | Issue |
|----------|-------|
| `wallets/frontend/public/manifest.json` L12, L18 | References `/icon-192.png` and `/icon-512.png` |
| `wallets/frontend/public/` | Contains `icon-192.svg` and `icon-512.svg` (no PNG) |

**Risk:** 404s for PNG icons; unlikely to cause malware. Fix for correctness.

### 2.5 External connect-src (low priority)

`next.config.js` CSP allows:

- `https://api.llama.fi`
- `https://api.rabby.io`
- `https://api.github.com`

These are used for data fetching. Verify none of these endpoints are serving flagged content.

### 2.6 False positive (crypto/wallet context)

Crypto and wallet sites are often flagged by security scanners because:

- They link to wallet vendors (Trezor, Ledger, Rabby, etc.)
- They discuss crypto and security
- They can be confused with phishing or scam sites

**Action:** Check VirusTotal and CleanDNS for the exact detection reason (phishing, malware, suspicious, etc.).

---

## 3. Diagnosis Steps

### Step 1: Verify the file hash

The report gives file hash: `ab5ce83454ba10b7af7287a0556a7feef2fb4a9a9e5d05f5599a377528ea888d`.

1. Build the frontend locally:
   ```bash
   cd wallets/frontend && npm run build
   ```
2. Compute SHA-256 of all built assets:
   ```bash
   find out -type f -exec sha256sum {} \; > /tmp/out-hashes.txt
   ```
3. Search for the reported hash:
   ```bash
   grep ab5ce83454ba10b7af7287a0556a7feef2fb4a9a9e5d05f5599a377528ea888d /tmp/out-hashes.txt
   ```
4. If using Amplify, download the deployed `out/` (or equivalent) and repeat.

### Step 2: Check VirusTotal

1. Open: `https://www.virustotal.com/gui/url/4da0b16abc7447d1f4a54a9c2c2d2cc2ae8db5c393ce3f2ca6ca7240bdc62cd5`
2. Note which engines flag it and why (malware, phishing, suspicious, etc.).
3. Check the "Details" tab for the exact URL and any related hashes.

### Step 3: Check CleanDNS case

1. Open the CleanDNS case link from the abuse email.
2. Review screenshots and "explanation of abuse."
3. Identify the exact page/URL and content that triggered the report.

### Step 4: Audit markdown for raw HTML

```bash
cd /workspace
rg -g "*.md" "<script|<iframe|<object|javascript:|data:" wallets/
rg -g "*.md" "<img[^>]+src=" wallets/
```

**Audit results (pre-run):**
- `video-transcripts.md`: `<script type="application/ld+json">` — inside code block template, JSON-LD only (not executable)
- `chains/README.md`, `SOFTWARE_WALLETS.md`, etc.: `<img src="/chains/eth.svg">` — all same-origin, no external URLs
- No malicious `<script>`, `<iframe>`, or `javascript:` found in content

### Step 5: Compare live site vs. repo

1. Fetch the live homepage:
   ```bash
   curl -sL "https://walletradar.org/" -o /tmp/live-index.html
   ```
2. Diff against a local build's `out/index.html` to spot injected content.

---

## 4. Remediation Options

### If malware is confirmed

1. **Identify source:** Use Steps 1–5 to find the file/URL matching the hash.
2. **Remove or replace:** Remove malicious content or replace compromised dependencies.
3. **Rebuild and redeploy:** Clean build and redeploy.
4. **Verify:** Re-scan on VirusTotal and request re-review from Porkbun.

### If false positive

1. **Document:** Screenshots of VirusTotal, CleanDNS, and any "clean" scan results.
2. **Reply to Porkbun:** Use the abuse email reply (keep subject line). Include:
   - Statement that the site is a legitimate wallet comparison/research site
   - Link to GitHub: https://github.com/chimera-defi/Etc-mono-repo/tree/main/wallets
   - Link to security.txt: https://walletradar.org/.well-known/security.txt
   - VirusTotal/CleanDNS details showing low or no detections
   - Offer to provide more evidence if needed
3. **Optional hardening:** Consider removing `rehype-raw` or restricting `img` sources to reduce future false positives.

### Hardening (regardless of outcome)

| Change | File | Description |
|--------|------|-------------|
| Fix PWA icons | `public/manifest.json` | Point to existing SVGs or add PNG icons |
| Restrict img src | `EnhancedMarkdownRenderer.tsx` | Validate/sanitize `img` `src` (same-origin or allowlist) |
| Consider removing rehype-raw | `EnhancedMarkdownRenderer.tsx` | If raw HTML is not needed |
| Add Subresource Integrity (SRI) | `layout.tsx` | For GA script if kept |

---

## 5. Key Files Reference

| Purpose | Path |
|---------|------|
| Root layout (GA, theme script) | `wallets/frontend/src/app/layout.tsx` |
| Markdown renderer (rehype-raw, img) | `wallets/frontend/src/components/EnhancedMarkdownRenderer.tsx` |
| CSP & security headers | `wallets/frontend/next.config.js` |
| PWA manifest | `wallets/frontend/public/manifest.json` |
| Markdown content | `wallets/*.md`, `wallets/articles/*.md` |
| Deploy config | `amplify.yml` |

---

## 6. Appeal Template (if false positive)

```
Subject: [KEEP ORIGINAL SUBJECT LINE]

We are the operators of walletradar.org and believe this report is a false positive.

Wallet Radar is an open-source, educational wallet comparison and research site:
- GitHub: https://github.com/chimera-defi/Etc-mono-repo/tree/main/wallets
- Security contact: https://walletradar.org/.well-known/security.txt

The site is a static Next.js export with no user-generated content. We have:
- Audited our codebase for the reported hash (ab5ce83454ba10b7af7287a0556a7feef2fb4a9a9e5d05f5599a377528ea888d) — not found in our build
- [Add VirusTotal/CleanDNS findings]
- [Add any hardening measures taken]

We request re-review. We are happy to provide additional evidence.
```

---

*Handoff created from Porkbun abuse report. Run diagnosis steps before replying to Porkbun.*
